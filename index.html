<!DOCTYPE html>
<html>
<head>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://use.fontawesome.com/9d6b0dab50.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/howler@2.0.15/dist/howler.min.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <script>
    $.getScript("https://cdn.rawgit.com/xsf3190/sequencerA/master/jszip.min.js");
  </script>
  
  <script type="text/javascript">

    "use strict";
    /*
    window.onload = function() {
      window.indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB;
      window.IDBTransaction = window.IDBTransaction || window.webkitIDBTransaction || window.msIDBTransaction;
      window.DBKeyRange = window.IDBKeyRange || window.webkitIDBKeyRange || window.msIDBKeyRange;  

      if (!window.indexedDB) {
        sweetAlert("Your browser doesn't support a stable version of IndexedDB.")
      }
    }
    */
      
    
    $(function() {
      
      var indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB;
      if (!indexedDB) {
        sweetAlert("Your browser doesn't support a stable version of IndexedDB.");
        return;
      }
      var IDBTransaction = window.IDBTransaction || window.webkitIDBTransaction || window.msIDBTransaction,
          DBKeyRange = window.IDBKeyRange || window.webkitIDBKeyRange || window.msIDBKeyRange,
          db;
      
      var DBOpenRequest = indexedDB.open("sounds", 1);

      DBOpenRequest.onerror = function(event) {
        sweetAlert("FAILED - opening IndexedDB.");
        return;
      };

      DBOpenRequest.onsuccess = function(event) {
        sweetAlert("SUCCESS - opening IndexedDB.");

        // store the result of opening the database in the db variable. This is used a lot below
        db = DBOpenRequest.result;

        // Run the displayData() function to populate the task list with all the to-do list data already in the IDB
        //displayData();
      };

  // This event handles the event whereby a new version of the database needs to be created
  // Either one has not been created before, or a new version number has been submitted via the
  // window.indexedDB.open line above
  DBOpenRequest.onupgradeneeded = function(event) {
    var db = event.target.result;

    db.onerror = function(event) {
      note.innerHTML += '<li>Error loading database.</li>';
    };

    // Create an objectStore for this database

    var objectStore = db.createObjectStore("toDoList", { keyPath: "taskTitle" });

    // define what data items the objectStore will contain

    objectStore.createIndex("hours", "hours", { unique: false });
    objectStore.createIndex("minutes", "minutes", { unique: false });
    objectStore.createIndex("day", "day", { unique: false });
    objectStore.createIndex("month", "month", { unique: false });
    objectStore.createIndex("year", "year", { unique: false });

    objectStore.createIndex("notified", "notified", { unique: false });

    note.innerHTML += '<li>Object store created.</li>';
  };
      
      
      var xhr = new XMLHttpRequest();
      xhr.open('GET', 'https://cdn.rawgit.com/xsf3190/sequencerA/master/sounds.zip', true);
      xhr.responseType = 'arraybuffer';

      xhr.onload = function(e) {
        if (this.status == 200) {
          // get binary data as a response
          alert("got zip file as arraybuffer");
          JSZip.loadAsync(this.response)                                   // 1) read the zip file
            .then(function(zip) {
                zip.forEach(function (relativePath, zipEntry) {  // 2) process each entry
                    zip.files[relativePath].async('text')
                    .then(function(data) {
                       //console.log(zipEntry.name);
                       $("body").append("<p>"+zipEntry.name+"</p>");
                    }); 
                });
            }, function (e) {
                sweetAlert("Error reading sounds.zip - " + e.message);
            });
        }
      };

      xhr.send();
      
    })
    
  </script>
  
</head>

<body>
  
  <p>Files in sounds.zip. 3.</p>
  
  
</body>

</html>
